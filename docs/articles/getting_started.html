<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • ssgbm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta property="og:description" content="ssgbm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ssgbm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/python_to_r.html">Python to R - Reference Table</a>
    </li>
    <li>
      <a href="../articles/update-doc.html">How to update documentation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bcgov/SSGBM-VRI-BEM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bcgov/SSGBM-VRI-BEM/blob/HEAD/vignettes/articles/getting_started.Rmd" class="external-link"><code>vignettes/articles/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<p>The purpose of this article is to help a user get started with the ssgbm package</p>
<div class="section level2">
<h2 id="goal-of-the-ssgbm-package">Goal of the ssgbm package<a class="anchor" aria-label="anchor" href="#goal-of-the-ssgbm-package"></a>
</h2>
<p>The goal of the ssgbm package is to create a file that can be use to run the RRM model.</p>
<p>This file is created by merging the following layers together</p>
<ul>
<li><p>VRI (vegetation ressource inventory <a href="https://www2.gov.bc.ca/assets/gov/farming-natural-resources-and-industry/forestry/stewardship/forest-analysis-inventory/data-management/standards/vegcomp_poly_rank1_data_dictionaryv5_2019.pdf" class="external-link">documentation</a>)</p></li>
<li><p>TEI (Terrestrial Ecosystem Information <a href="https://www2.gov.bc.ca/assets/gov/environment/plants-animals-and-ecosystems/ecosystems/terrestrial-ecosystem/tei_digital_submission_standards_draft1.pdf" class="external-link">documentation</a>) with BEU fields (Broad Terrestrial Ecosystem <a href="https://www2.gov.bc.ca/assets/gov/environment/natural-resource-stewardship/nr-laws-policy/risc/bei.pdf" class="external-link">documentation</a>)</p></li>
<li><p>Wetlands</p></li>
<li><p>Rivers</p></li>
<li><p>Consolidated Cutblocks</p></li>
<li><p>Elevation</p></li>
</ul>
<p>The resulting feature class is usually refereed to as the vri-bem</p>
<div class="figure">
<img src="layer_merge.PNG" alt="A caption" width="100%"><p class="caption">
A caption
</p>
</div>
<p>Once the layers are merged together, some corrections are done on the TEI attributes based on the VRI attributes, the intersections with rivers and the percentage of the polygon covered by wetlands. Some of the corrections are done by using the csv files in the csv directory</p>
<ul>
<li>Allowed_BEC_BEUs_NE_ALL</li>
<li>beu_wetland_updates</li>
</ul>
<p>After all the correction on the TEI attributes have been done, some new attributes are created based on the elevation and the slope. Also, the forest age is computed using the consolidated cut blocks layer.</p>
<p>Following the creation of those new attributes, several new attributes (see below) of the ecosystem are merged on the vri-bem using the Skeena_VRIBEM_LUT csv file.</p>
<ul>
<li>Forested (Y/N),</li>
<li>Strict_Climax,</li>
<li>Stand_Climax,</li>
<li>Stand_Age_0-15, Stand_Age_16-30, Stand_Age_31-50, Stand_Age_51-80, Stand_Age_80+,</li>
<li>Struct_Age_0-3, Struct_Age_4-10, Struct_Age_11-30, Struct_Age_31-40, Struct_Age_41-60, Struct_Age_61-80, Struct_Age_81-139, Struct_Age_140_249, Struct_Age_250+,</li>
<li>Snow_code</li>
</ul>
<p>If you are running the ssgbm package on a new area for the first time, you will need to create and fill this csv file so that you are able to create the desired output file (this article will cover that part later).</p>
<p>Before creating the final output file, the STD_VRI, CROWN_BEAR and CROWN_MOOSE are created based on the type of species and the crown closure of the ecosystem.</p>
<p>Finally, the output file needed for using the RRM model is created by aggregating all the possible combination of the following attributes together</p>
<ul>
<li>ECO_SEC</li>
<li>BGC_ZONE</li>
<li>BGC_SUBZON</li>
<li>BGC_VRT</li>
<li>BGC_PHASE</li>
<li>BEUMC (BEUMC_S1, BEUMC_S2, BEUMC_S3)</li>
<li>SLOPE_MOD</li>
<li>SITE_M3A</li>
<li>SNOW_CODE</li>
<li>ABOVE_ELEV_THOLD</li>
<li>CROWN_MOOSE (CROWN_MOOSE_1, CROWN_MOOSE_2, CROWN_MOOSE_3)</li>
<li>STRCT (STRCT_S1, STRCT_S2, STRCT_S3)</li>
<li>STAND (STAND_A1, STAND_A2, STAND_A3)</li>
<li>FORESTED (FORESTED_1, FORESTED_2, FORESTED_3)</li>
</ul>
<p>The following sections of this article will cover in more details how you can achieve all the above using the ssgbm package.</p>
<p>We suggest reading all the sections before jumping in the good stuff. However, if you are too eager to try the ssgbm package, you can get good starting points from the R files in the scripts folder of the <a href="https://github.com/bcgov/SSGBM-VRI-BEM/tree/main/scripts" class="external-link">github repositery</a></p>
</div>
<div class="section level2">
<h2 id="getting-all-the-required-layers">Getting all the required layers<a class="anchor" aria-label="anchor" href="#getting-all-the-required-layers"></a>
</h2>
<p>The first step required to be able to use the ssgbm functions is to get all the required layers.</p>
<p>Most layers are available publicly and can be downloaded from the <a href="https://catalogue.data.gov.bc.ca/" class="external-link">bcgov catalogue</a> (you will probably prefer this option if you want to work with raster see the [Rasterizing Layers of interest] section)</p>
<p>Note that the BEU fields (Broad Terrestrial Ecosystem <a href="https://www2.gov.bc.ca/assets/gov/environment/natural-resource-stewardship/nr-laws-policy/risc/bei.pdf" class="external-link">documentation</a>) and elevation layers are not available publicly.</p>
<p>However, all the other layers can also be imported into R using via the bcdata package. Fortunately, the ssgbm package has functions to help you import those layers more easily (see the <a href="#read_layer-functions">Read_layer functions</a> section).</p>
<div class="section level3">
<h3 id="read_layer-functions">Read_layer functions<a class="anchor" aria-label="anchor" href="#read_layer-functions"></a>
</h3>
<p>All the layers of interest (except the TEI+BEU and elevation) can be imported via the read_layer functions. The read_layer also accept a well-known text filter, if you only want to import a region of interest</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="st">"POLYGON ((1023955 988730.2, 1065018 988730.2, 1065018 1016988, 1023955 1016988, 1023955 988730.2))"</span>
<span class="va">vri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_vri.html">read_vri</a></span><span class="op">(</span>wkt_filter <span class="op">=</span> <span class="va">aoi</span><span class="op">)</span>
<span class="va">rivers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_rivers.html">read_rivers</a></span><span class="op">(</span>wkt_filter <span class="op">=</span> <span class="va">aoi_wkt</span><span class="op">)</span>
<span class="va">wetlands</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_wetlands.html">read_wetlands</a></span><span class="op">(</span>wkt_filter <span class="op">=</span> <span class="va">aoi_wkt</span><span class="op">)</span>
<span class="va">ccb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ccb.html">read_ccb</a></span><span class="op">(</span>wkt_filter <span class="op">=</span> <span class="va">aoi_wkt</span><span class="op">)</span></code></pre></div>
<p>you can learn more about each of the read_layer by using the help command</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">read_vri</span><span class="op">)</span></code></pre></div>
<p>or by via the <a href="https://bcgov.github.io/SSGBM-VRI-BEM/reference/index.html" class="external-link">Reference tab of the documentation</a>.</p>
</div>
<div class="section level3">
<h3 id="rasterizing-the-layers-of-interest">Rasterizing the Layers of Interest<a class="anchor" aria-label="anchor" href="#rasterizing-the-layers-of-interest"></a>
</h3>
<p>The ssgbm package support the use of rasters as input for the creation of the RRM file. However there is no readily available rasters of the layers needed for the creation of the RRM file, that means that you will need to create them yourself. Don’t worry, the ssgbm package can help you with that!</p>
<p>First, you need to know that you will be be working with pretty big files, that means that you probably won’t be able to load all those files in the computer memory (RAM) unless you are using cloud computing or have access to a computer with lots of RAM. Fortunately, the ssgbm package make use of the gdal utilities directly to create the raster files so that you don’t need to load anything in the computer memory. That also mean that you will need to have a copy of all the layers of interest saved somewhere on your disk to use the rasterize feature of the ssgbm package. That’s why it’s preferable to download the layers directly from the <a href="https://catalogue.data.gov.bc.ca/" class="external-link">bcgov catalogue</a> instead of using the read_layer functions (because you would need to load the layers in memory before being able to save them on your disk)</p>
<p>The function used to create a raster from a geospatial vector data (a geospatial database with geometries (points, lines, polygon, etc)) is <code>rasterize_sf</code></p>
<p>To transform a geospatial vector data to a raster, <code>rasterize_sf</code> needs the following information</p>
<ul>
<li>
<code>src_datasource</code> The path of the geospatial vector data you want to convert into a raster (example “C:/geodata/vri.gbd”)</li>
<li>
<code>dst_filename</code> The path of the resulting raster you want to create (example “C:/geodata/vri_raster.tif”)</li>
<li>
<code>layer</code> If your datasource is geospatial database with multiple layers, you need to specify the layer you want to convert into a raster, if you want to convert all the layers, simply run the function multiple time by specifying the desired layer each time.</li>
<li>The raster attributes can be specify in two ways
<ul>
<li>
<code>reference</code> The path of the raster you want to your new raster to be based on (will use the same crs , same extent and same resolution as the reference raster)</li>
<li>
<code>a_srs</code> <code>te</code> <code>tr</code> Specify the crs, extent and resolution of your new raster directly</li>
</ul>
</li>
<li>
<code>numeric_attributes</code> The name of the attributes of type numeric you want to add your raster, <code>rasterize_sf</code> creates one layer per attributes</li>
<li>
<code>character_attributes</code> The name of the attributes of type character you want to add your raster, <code>rasterize_sf</code> creates one layer per attributes. Note that if you want to rasterize character attributes you also need to pass a <code>factor_conv_list</code> to tell <code>rasterize_sf</code> what values to burn in the raster (will get to that in more details later <a href="#character-attributes">Character Attributes</a>)</li>
<li>
<code>date_attributes</code> The name of the attributes of type date you want to add your raster, <code>rasterize_sf</code> creates one layer per attributes</li>
<li>
<code>burn</code> The name of the raster layer, if you want create a layer that contains 1 where the polygons of the source geospatial vector data intersect with the extent of your raster (useful for creating a raster for the position of rivers for example)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rasterize_sf.html">rasterize_sf</a></span><span class="op">(</span><span class="st">"../SSGBM-VRI-BEM-data/BEM_VRI"</span>, <span class="st">"../SSGBM-VRI-BEM-data/bem_test.tif"</span>, reference <span class="op">=</span> <span class="st">"../SSGBM-VRI-BEM-data/DEM_tif/dem.tif"</span>, numeric_attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TEIS_ID"</span>, <span class="st">"SDEC_1"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="st">"BEM"</span><span class="op">)</span></code></pre></div>
<p>Once again you can get more information by using the help command</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">rasterize_sf</span><span class="op">)</span></code></pre></div>
<p>or by via the <a href="https://bcgov.github.io/SSGBM-VRI-BEM/reference/index.html" class="external-link">Reference tab of the documentation</a>.</p>
<div class="section level4">
<h4 id="character-attributes">Character Attributes<a class="anchor" aria-label="anchor" href="#character-attributes"></a>
</h4>
<p>By design, rasters are made to only contain numeric values. That means that if you want to create a raster layer for a character attribute from a geospatial vector data you need to tell <code>rasterize_sf</code> what values to burn in the raster for all possible character values that this attribute can take. <code>rasterize_sf</code> expect a list containing data.table objects with the mapping for each character attributes you want to rasterize.</p>
<p>for example, if I had an attributes called “TYPE” that could take the following values : “good”, “ok”, “bad” I would create the following data.table to map numeric values for each of the possible values</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'data.table' was built under R version 4.1.2</span>
<span class="va">type_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_character_</span>, <span class="st">"good"</span>, <span class="st">"ok"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>
<span class="va">type_mapping</span><span class="op">[</span>, <span class="va">factor</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">.N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>

<span class="va">type_mapping</span>
<span class="co">#&gt;    value factor</span>
<span class="co">#&gt; 1:  &lt;NA&gt;      0</span>
<span class="co">#&gt; 2:  good      1</span>
<span class="co">#&gt; 3:    ok      2</span>
<span class="co">#&gt; 4:   bad      3</span></code></pre></div>
<p>Note that we assign the value 0 to the possibility NA_character_. It’s because 0 is the default value for raster when there is no information for a raster cell</p>
<p>Now that we have a data.table for the mapping of our variable we use <code>rasterize_sf</code> to create a raster layer for this variable based on the mapping we have written in the data.table</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rasterize_sf.html">rasterize_sf</a></span><span class="op">(</span><span class="st">"../SSGBM-VRI-BEM-data/BEM_VRI"</span>, <span class="st">"../SSGBM-VRI-BEM-data/bem_test.tif"</span>, reference <span class="op">=</span> <span class="st">"../SSGBM-VRI-BEM-data/DEM_tif/dem.tif"</span>, numeric_attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TEIS_ID"</span>, <span class="st">"SDEC_1"</span><span class="op">)</span>,
             character_attributes <span class="op">=</span> <span class="st">"TYPE"</span>,factor_conv_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>TYPE <span class="op">=</span> <span class="va">type_mapping</span><span class="op">)</span> , layer <span class="op">=</span> <span class="st">"BEM"</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Karine Pigeon, Nicolas Gauthier, François Bornais, Province of British Columbia.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
